
<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <title>Iron Fish ‚Äì Mining Dashboard | TORINVEST</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <style>
    :root {
      --bg: #050509;
      --card: #11111c;
      --card-soft: #0b0b13;
      --accent: #ffb400;
      --accent-soft: rgba(255, 180, 0, 0.14);
      --text: #f5f5f7;
      --muted: #9a9aad;
      --danger: #ff4b5c;
      --good: #2bd67b;
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: radial-gradient(circle at top, #151528 0, #050509 55%);
      color: var(--text);
      line-height: 1.6;
      min-height: 100vh;
    }

    .page {
      max-width: 1100px;
      margin: 0 auto;
      padding: 32px 16px 64px;
    }

    .pill {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 4px 10px;
      border-radius: 999px;
      border: 1px solid rgba(255, 180, 0, 0.5);
      background: rgba(255, 180, 0, 0.08);
      color: var(--accent);
      font-size: 11px;
      letter-spacing: 0.15em;
      text-transform: uppercase;
      margin-bottom: 12px;
    }

    .pill-dot {
      width: 7px;
      height: 7px;
      border-radius: 999px;
      background: #2bd67b;
      box-shadow: 0 0 6px #2bd67b;
    }

    h1 {
      font-size: 28px;
      font-weight: 800;
      margin-bottom: 6px;
      background: linear-gradient(120deg, #ffb400, #ff4b5c);
      -webkit-background-clip: text;
      color: transparent;
    }

    .subtitle {
      font-size: 14px;
      color: var(--muted);
      max-width: 640px;
      margin-bottom: 24px;
    }

    .layout {
      display: grid;
      grid-template-columns: minmax(0, 1.3fr) minmax(0, 1.2fr);
      gap: 18px;
      align-items: stretch;
    }

    .card {
      background: var(--card);
      border-radius: 18px;
      padding: 16px 18px 14px;
      border: 1px solid rgba(255, 255, 255, 0.05);
      box-shadow: 0 18px 40px rgba(0, 0, 0, 0.5);
    }

    .card-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 10px;
    }

    .card-title {
      font-size: 15px;
      font-weight: 600;
    }

    .badge {
      font-size: 11px;
      padding: 2px 8px;
      border-radius: 999px;
      background: rgba(255, 255, 255, 0.04);
      color: var(--muted);
    }

    .grid-2 {
      display: grid;
      grid-template-columns: repeat(2, minmax(0, 1fr));
      gap: 8px 24px;
      font-size: 13px;
      color: var(--muted);
    }

    .label {
      color: #bdbdd0;
      font-size: 12px;
    }

    .value {
      font-size: 14px;
      color: var(--text);
      font-weight: 500;
    }

    .addr {
      font-family: "JetBrains Mono", ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
      font-size: 11px;
      color: var(--muted);
      margin-top: 8px;
      word-break: break-all;
    }

    .hint {
      margin-top: 10px;
      font-size: 11px;
      color: var(--muted);
    }

    .hint span {
      color: var(--accent);
    }

    /* Mini charts */

    .charts {
      display: grid;
      grid-template-columns: repeat(2, minmax(0, 1fr));
      gap: 12px;
      margin-top: 6px;
    }

    .chart-block {
      background: var(--card-soft);
      border-radius: 14px;
      padding: 10px 12px 10px;
      border: 1px solid rgba(255, 255, 255, 0.04);
    }

    .chart-title {
      font-size: 12px;
      color: #c2c2d4;
      margin-bottom: 4px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .chart-sub {
      font-size: 11px;
      color: var(--muted);
    }

    .slider-axis {
      position: relative;
      height: 26px;
      margin-top: 6px;
    }

    .slider-line {
      position: absolute;
      top: 50%;
      left: 4px;
      right: 4px;
      height: 3px;
      border-radius: 999px;
      background: linear-gradient(90deg, #ff4b5c, #ffb400, #2bd67b);
      opacity: 0.6;
    }

    .slider-thumb {
      position: absolute;
      top: 50%;
      width: 12px;
      height: 12px;
      border-radius: 999px;
      background: #f5f5f7;
      transform: translate(-50%, -50%);
      box-shadow: 0 0 8px rgba(0, 0, 0, 0.7);
    }

    .slider-labels {
      display: flex;
      justify-content: space-between;
      font-size: 10px;
      margin-top: 4px;
      color: var(--muted);
    }

    .bar-list {
      margin-top: 6px;
    }

    .bar-row {
      display: flex;
      align-items: center;
      gap: 6px;
      margin-bottom: 4px;
      font-size: 11px;
      color: var(--muted);
    }

    .bar {
      flex: 1;
      height: 7px;
      border-radius: 999px;
      background: rgba(255, 255, 255, 0.05);
      overflow: hidden;
    }

    .bar-fill {
      height: 100%;
      width: 0%;
      background: linear-gradient(90deg, #ffb400, #2bd67b);
      transition: width 0.4s ease-out;
    }

    .legend-dot {
      width: 7px;
      height: 7px;
      border-radius: 999px;
      background: #ffb400;
    }

    .legend-dot.alt {
      background: #2bd67b;
    }

    .status-pill {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      font-size: 11px;
      padding: 2px 8px;
      border-radius: 999px;
      background: rgba(43, 214, 123, 0.12);
      color: var(--good);
    }

    .status-pill.off {
      background: rgba(255, 75, 92, 0.12);
      color: var(--danger);
    }

    .status-dot {
      width: 6px;
      height: 6px;
      border-radius: 999px;
      background: currentColor;
      box-shadow: 0 0 6px currentColor;
    }

    .footer-note {
      margin-top: 18px;
      font-size: 11px;
      color: var(--muted);
      max-width: 720px;
    }

    .btn-home {
      position: fixed;
      bottom: 20px;
      right: 20px;
      padding: 8px 14px;
      border-radius: 999px;
      background: rgba(255, 180, 0, 0.16);
      border: 1px solid rgba(255, 180, 0, 0.4);
      color: var(--accent);
      font-size: 12px;
      text-decoration: none;
      backdrop-filter: blur(6px);
      transition: 0.2s ease;
    }

    .btn-home:hover {
      background: rgba(255, 180, 0, 0.3);
      transform: translateY(-2px);
    }

    @media (max-width: 900px) {
      .layout {
        grid-template-columns: minmax(0, 1fr);
      }
    }
  </style>
</head>
<body>
  <div class="page">
    <div class="pill">
      <span class="pill-dot"></span>
      TORINVEST ‚Ä¢ IRON FISH
    </div>

    <h1>Iron Fish ‚Äì Mining Dashboard</h1>
    <p class="subtitle">
      Vue synth√©tique de l‚Äôactivit√© de minage Iron Fish via Herominers.
      Objectif : lire en un coup d‚Äô≈ìil la puissance, les soldes et le rythme
      des rewards, sans se perdre dans 40 onglets.
    </p>

    <div class="layout">
      <!-- Statut du mineur -->
      <section class="card">
        <div class="card-header">
          <div class="card-title">Statut du mineur</div>
          <div id="iron-status-pill" class="status-pill off">
            <span class="status-dot"></span>
            <span id="iron-status-text">Offline / en pause</span>
          </div>
        </div>

        <div class="grid-2">
          <div>
            <div class="label">Hashrate actuel</div>
            <div class="value" id="iron-hashrate-current">‚Äì</div>
          </div>
          <div>
            <div class="label">Hashrate 1h (moyenne)</div>
            <div class="value" id="iron-hashrate-1h">‚Äì</div>
          </div>
          <div>
            <div class="label">Hashrate 6h (moyenne)</div>
            <div class="value" id="iron-hashrate-6h">‚Äì</div>
          </div>
          <div>
            <div class="label">Hashrate 24h (moyenne)</div>
            <div class="value" id="iron-hashrate-24h">‚Äì</div>
          </div>

          <div>
            <div class="label">Total pay√©</div>
            <div class="value" id="iron-total-paid">‚Äì</div>
          </div>
          <div>
            <div class="label">En attente (pending)</div>
            <div class="value" id="iron-pending">‚Äì</div>
          </div>
          <div>
            <div class="label">Non confirm√©</div>
            <div class="value" id="iron-unconfirmed">‚Äì</div>
          </div>
          <div>
            <div class="label">Dernier paiement</div>
            <div class="value" id="iron-last-payout">‚Äì</div>
          </div>
        </div>

        <div class="addr">
          Adresse suivie : <span id="iron-address"></span>
        </div>

        <p class="hint">
          ‚ö° Donn√©es r√©cup√©r√©es en temps r√©el via l‚ÄôAPI publique Herominers
          (lecture seule). <span>Aucune promesse de gains</span> ‚Äî c‚Äôest un
          tableau de bord p√©dagogique pour la Forge TORINVEST.
        </p>
      </section>

      <!-- Visualisation rapide -->
      <section class="card">
        <div class="card-header">
          <div class="card-title">Visualisation rapide</div>
          <div class="badge">Vue intra-jour</div>
        </div>

        <div class="charts">
          <!-- Slider "feeling" de puissance -->
          <div class="chart-block">
            <div class="chart-title">
              <span>Hashrate (instant, 1h, 24h)</span>
              <span class="chart-sub" id="iron-hashrate-trend-label">‚Äì</span>
            </div>
            <div class="slider-axis">
              <div class="slider-line"></div>
              <div class="slider-thumb" id="iron-hashrate-slider" style="left: 50%;"></div>
            </div>
            <div class="slider-labels">
              <span>Instant</span>
              <span>1h</span>
              <span>24h</span>
            </div>
          </div>

          <!-- R√©partition des soldes -->
          <div class="chart-block">
            <div class="chart-title">
              <span>R√©partition des soldes (IRON)</span>
            </div>

            <div class="bar-list">
              <div class="bar-row">
                <div class="legend-dot"></div>
                <span>Pay√©</span>
                <div class="bar">
                  <div class="bar-fill" id="bar-paid"></div>
                </div>
                <span id="label-paid" class="chart-sub">‚Äì</span>
              </div>

              <div class="bar-row">
                <div class="legend-dot alt"></div>
                <span>En attente</span>
                <div class="bar">
                  <div class="bar-fill" id="bar-pending"></div>
                </div>
                <span id="label-pending" class="chart-sub">‚Äì</span>
              </div>

              <div class="bar-row">
                <div class="legend-dot" style="background:#ff4b5c;"></div>
                <span>Non confirm√©</span>
                <div class="bar">
                  <div class="bar-fill" id="bar-unconfirmed"></div>
                </div>
                <span id="label-unconfirmed" class="chart-sub">‚Äì</span>
              </div>
            </div>
          </div>
        </div>

        <p class="footer-note">
          Les mini-graphiques ne remplacent pas les dashboards Herominers : ils
          servent juste √† donner un ‚Äúfeeling‚Äù visuel rapide de la puissance et
          de la r√©partition des rewards dans l‚Äôunivers TORINVEST.
        </p>
      </section>
    </div>
  </div>

  <a href="index.html" class="btn-home">‚Üê Retour accueil</a>

  <script>
    // üëâ √Ä ADAPTER : ton adresse + l'URL de ton Worker
    const IRON_ADDRESS =
      "d572538e2ddbc02611f9ab5033be81b17cb4fcb7756865742523861ca320b107";

    // Remplace par l'URL de ton Worker Cloudflare
    const WORKER_BASE_URL =
      "https://ironfish-proxy.torinvest.workers.dev"; // EXEMPLE

    const API_URL = `${WORKER_BASE_URL}/?address=${IRON_ADDRESS}`;

    // Helpers
    function formatHashrate(hs) {
      if (!hs || hs <= 0) return "0 H/s";
      if (hs >= 1e9) return (hs / 1e9).toFixed(2) + " GH/s";
      if (hs >= 1e6) return (hs / 1e6).toFixed(2) + " MH/s";
      if (hs >= 1e3) return (hs / 1e3).toFixed(2) + " kH/s";
      return hs.toFixed(2) + " H/s";
    }

    function formatIron(x) {
      if (x == null) return "0 IRON";
      const n = Number(x);
      if (isNaN(n)) return x + " IRON";
      if (n < 0.01) return n.toFixed(4) + " IRON";
      if (n < 1) return n.toFixed(3) + " IRON";
      return n.toFixed(2) + " IRON";
    }

    function setText(id, value) {
      const el = document.getElementById(id);
      if (el) el.textContent = value;
    }

    async function loadIronFishStats() {
      try {
        const resp = await fetch(API_URL);
        const data = await resp.json();

        // üîç Premi√®re fois : regarde dans la console pour voir la structure exacte
        console.log("IronFish raw data:", data);

        // Les noms de champs ci-dessous sont bas√©s sur ce que renvoie
        // g√©n√©ralement Herominers. Si besoin, adapte apr√®s avoir regard√© le log.
        const stats = data;

        const hrCurrent = Number(stats.hashrate) || 0;
        const hr1h = Number(stats.hashrate_1h || stats.hashrate_1_hour || 0);
        const hr6h = Number(stats.hashrate_6h || stats.hashrate_6_hours || 0);
        const hr24h = Number(stats.hashrate_24h || stats.hashrate_24_hours || 0);

        const totalPaid = Number(stats.total_paid || stats.totalPaid || stats.total_paid_iron || 0);
        const pending = Number(stats.pending || stats.pending_balance || 0);
        const unconfirmed = Number(stats.unconfirmed_balance || stats.unconfirmed || 0);
        const lastPayout = stats.last_payment_time || stats.lastShare || "‚Äì";

        // ‚ûú Maj texte
        setText("iron-address", IRON_ADDRESS);
        setText("iron-hashrate-current", formatHashrate(hrCurrent));
        setText("iron-hashrate-1h", formatHashrate(hr1h));
        setText("iron-hashrate-6h", formatHashrate(hr6h));
        setText("iron-hashrate-24h", formatHashrate(hr24h));

        setText("iron-total-paid", formatIron(totalPaid));
        setText("iron-pending", formatIron(pending));
        setText("iron-unconfirmed", formatIron(unconfirmed));
        setText("iron-last-payout", String(lastPayout));

        // ‚ûú Statut online / offline (simple seuil)
        const statusPill = document.getElementById("iron-status-pill");
        const statusText = document.getElementById("iron-status-text");
        if (hrCurrent > 0) {
          statusPill.classList.remove("off");
          statusText.textContent = "Online / hashrate actif";
        } else {
          statusPill.classList.add("off");
          statusText.textContent = "Offline / en pause";
        }

        // ‚ûú Slider hashrate (position entre 0% et 100%)
        const slider = document.getElementById("iron-hashrate-slider");
        const trendLabel = document.getElementById("iron-hashrate-trend-label");

        const maxRef = Math.max(hrCurrent, hr1h, hr24h, 1);
        const ratioCurrent = hrCurrent / maxRef;
        const ratio1h = hr1h / maxRef;
        const ratio24h = hr24h / maxRef;

        // Ici je fais une moyenne pond√©r√©e pour la position
        const sliderPos =
          (ratioCurrent * 0.5 + ratio1h * 0.3 + ratio24h * 0.2) * 100;
        slider.style.left = `${Math.min(100, Math.max(0, sliderPos))}%`;

        if (hrCurrent > hr1h * 1.05 && hrCurrent > hr24h * 1.05) {
          trendLabel.textContent = "Spike de puissance";
        } else if (hrCurrent < hr1h * 0.9 && hrCurrent < hr24h * 0.9) {
          trendLabel.textContent = "Sous la moyenne";
        } else {
          trendLabel.textContent = "Dans la zone normale";
        }

        // ‚ûú Barres de r√©partition des soldes
        const totalBalance = totalPaid + pending + unconfirmed || 1;

        const pctPaid = (totalPaid / totalBalance) * 100;
        const pctPending = (pending / totalBalance) * 100;
        const pctUnconf = (unconfirmed / totalBalance) * 100;

        function setBar(id, valuePct) {
          const el = document.getElementById(id);
          if (el) el.style.width = `${Math.min(100, valuePct)}%`;
        }

        setBar("bar-paid", pctPaid);
        setBar("bar-pending", pctPending);
        setBar("bar-unconfirmed", pctUnconf);

        setText("label-paid", formatIron(totalPaid));
        setText("label-pending", formatIron(pending));
        setText("label-unconfirmed", formatIron(unconfirmed));
      } catch (e) {
        console.error("Erreur lors du chargement IronFish :", e);
      }
    }

    loadIronFishStats();
    // Si tu veux rafra√Æchir automatiquement toutes les 5 minutes :
    // setInterval(loadIronFishStats, 5 * 60 * 1000);
  </script>
</body>
</html>
